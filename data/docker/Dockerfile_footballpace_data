FROM python:3.12
COPY --from=ghcr.io/astral-sh/uv:0.7.13 /uv /uvx /bin/

WORKDIR /opt/dagster/app

COPY uv.lock /opt/dagster/app/uv.lock
COPY pyproject.toml /opt/dagster/app/pyproject.toml
COPY footballpace /opt/dagster/app/footballpace

RUN uv sync --locked --extra docker
ENV PATH="/opt/dagster/app/.venv/bin:$PATH"

EXPOSE 4000

CMD ["dagster", "api", "grpc", "-h", "0.0.0.0", "-p", "4000", "-m", "footballpace.definitions"]
